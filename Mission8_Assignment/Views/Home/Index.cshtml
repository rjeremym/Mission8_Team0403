@model IEnumerable<Mission8_Assignment.Models.Quadrant>

@* Quadrants index view – shows all incomplete tasks organized into Stephen Covey's four quadrants. *@
@{
    ViewData["Title"] = "Quadrants";

    @* Filter to only tasks that are not completed; fall back to an empty sequence of the correct model type. *@
    var incompleteTasks = Model?.Where(t => !t.completed) ?? Enumerable.Empty<Mission8_Assignment.Models.Quadrant>();

    @* Each quadrant list is filtered by quadrant number and ordered by parsed due date.
       dueDate is stored as text in SQLite, so we parse it to DateTime for proper chronological sorting. *@
    var q1Tasks = incompleteTasks
        .Where(t => t.quadrant == 1)
        .OrderBy(t => System.DateTime.TryParse(t.dueDate, out var dt) ? dt : System.DateTime.MaxValue);
    var q2Tasks = incompleteTasks
        .Where(t => t.quadrant == 2)
        .OrderBy(t => System.DateTime.TryParse(t.dueDate, out var dt) ? dt : System.DateTime.MaxValue);
    var q3Tasks = incompleteTasks
        .Where(t => t.quadrant == 3)
        .OrderBy(t => System.DateTime.TryParse(t.dueDate, out var dt) ? dt : System.DateTime.MaxValue);
    var q4Tasks = incompleteTasks
        .Where(t => t.quadrant == 4)
        .OrderBy(t => System.DateTime.TryParse(t.dueDate, out var dt) ? dt : System.DateTime.MaxValue);
}

<div class="container my-4">
    <h2 class="mb-4 text-center">Task Quadrants</h2>

    @* Top row of the 2x2 grid: Quadrants I and II side by side. *@
    <div class="row mb-4">
        @* Quadrant I – Important / Urgent *@
        <div class="col-md-6 mb-3">
            <div class="card h-100">
                <div class="card-header bg-danger text-white">
                    <strong>Quadrant I</strong> – Important / Urgent
                </div>
                <div class="card-body">
                    @* If there are no tasks in this quadrant, show a simple empty-state message. *@
                    @if (!q1Tasks.Any())
                    {
                        <p class="text-muted mb-0">No tasks in this quadrant.</p>
                    }
                    else
                    {
                        <div class="list-group list-group-flush">
                            @foreach (var item in q1Tasks)
                            {
                                <div class="list-group-item">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h6 class="mb-1">@item.task</h6>
                                            <small class="d-block text-muted">
                                                Due: @item.dueDate
                                            </small>
                                            @* Category is optional; only render the label if a category was assigned. *@
                                            @if (item.Category != null)
                                            {
                                                <small class="d-block text-muted">
                                                    Category: @item.Category.CategoryName
                                                </small>
                                            }
                                        </div>
                                        @* Actions for this task: edit, delete, and mark complete. *@
                                        <div class="ms-3 text-nowrap">
                                            @* Edit and Delete use GET requests via anchor tag helpers, routing by TaskId. *@
                                            <a asp-action="addTask"
                                               asp-route-id="@item.TaskId"
                                               class="btn btn-sm btn-primary me-1">
                                                Edit
                                            </a>
                                            <a asp-action="Delete"
                                               asp-route-id="@item.TaskId"
                                               class="btn btn-sm btn-outline-danger me-1">
                                                Delete
                                            </a>
                                            @* Mark Complete is a POST so that changing state is not done via a GET request. *@
                                            <form asp-action="MarkComplete"
                                                  asp-route-id="@item.TaskId"
                                                  method="post"
                                                  class="d-inline">
                                                <button type="submit" class="btn btn-sm btn-success">
                                                    Mark Complete
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>

        @* Quadrant II – Important / Not Urgent *@
        <div class="col-md-6 mb-3">
            <div class="card h-100">
                <div class="card-header bg-primary text-white">
                    <strong>Quadrant II</strong> – Important / Not Urgent
                </div>
                <div class="card-body">
                    @* Same empty-state behavior as Quadrant I, scoped to Quadrant II tasks. *@
                    @if (!q2Tasks.Any())
                    {
                        <p class="text-muted mb-0">No tasks in this quadrant.</p>
                    }
                    else
                    {
                        <div class="list-group list-group-flush">
                            @foreach (var item in q2Tasks)
                            {
                                <div class="list-group-item">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h6 class="mb-1">@item.task</h6>
                                            <small class="d-block text-muted">
                                                Due: @item.dueDate
                                            </small>
                                            @if (item.Category != null)
                                            {
                                                <small class="d-block text-muted">
                                                    Category: @item.Category.CategoryName
                                                </small>
                                            }
                                        </div>
                                        <div class="ms-3 text-nowrap">
                                            <a asp-action="addTask"
                                               asp-route-id="@item.TaskId"
                                               class="btn btn-sm btn-primary me-1">
                                                Edit
                                            </a>
                                            <a asp-action="Delete"
                                               asp-route-id="@item.TaskId"
                                               class="btn btn-sm btn-outline-danger me-1">
                                                Delete
                                            </a>
                                            <form asp-action="MarkComplete"
                                                  asp-route-id="@item.TaskId"
                                                  method="post"
                                                  class="d-inline">
                                                <button type="submit" class="btn btn-sm btn-success">
                                                    Mark Complete
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    @* Bottom row of the 2x2 grid: Quadrants III and IV side by side. *@
    <div class="row">
        @* Quadrant III – Not Important / Urgent *@
        <div class="col-md-6 mb-3">
            <div class="card h-100">
                <div class="card-header bg-warning text-dark">
                    <strong>Quadrant III</strong> – Not Important / Urgent
                </div>
                <div class="card-body">
                    @if (!q3Tasks.Any())
                    {
                        <p class="text-muted mb-0">No tasks in this quadrant.</p>
                    }
                    else
                    {
                        <div class="list-group list-group-flush">
                            @foreach (var item in q3Tasks)
                            {
                                <div class="list-group-item">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h6 class="mb-1">@item.task</h6>
                                            <small class="d-block text-muted">
                                                Due: @item.dueDate
                                            </small>
                                            @if (item.Category != null)
                                            {
                                                <small class="d-block text-muted">
                                                    Category: @item.Category.CategoryName
                                                </small>
                                            }
                                        </div>
                                        <div class="ms-3 text-nowrap">
                                            <a asp-action="addTask"
                                               asp-route-id="@item.TaskId"
                                               class="btn btn-sm btn-primary me-1">
                                                Edit
                                            </a>
                                            <a asp-action="Delete"
                                               asp-route-id="@item.TaskId"
                                               class="btn btn-sm btn-outline-danger me-1">
                                                Delete
                                            </a>
                                            <form asp-action="MarkComplete"
                                                  asp-route-id="@item.TaskId"
                                                  method="post"
                                                  class="d-inline">
                                                <button type="submit" class="btn btn-sm btn-success">
                                                    Mark Complete
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>

        @* Quadrant IV – Not Important / Not Urgent *@
        <div class="col-md-6 mb-3">
            <div class="card h-100">
                <div class="card-header bg-secondary text-white">
                    <strong>Quadrant IV</strong> – Not Important / Not Urgent
                </div>
                <div class="card-body">
                    @if (!q4Tasks.Any())
                    {
                        <p class="text-muted mb-0">No tasks in this quadrant.</p>
                    }
                    else
                    {
                        <div class="list-group list-group-flush">
                            @foreach (var item in q4Tasks)
                            {
                                <div class="list-group-item">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h6 class="mb-1">@item.task</h6>
                                            <small class="d-block text-muted">
                                                Due: @item.dueDate
                                            </small>
                                            @if (item.Category != null)
                                            {
                                                <small class="d-block text-muted">
                                                    Category: @item.Category.CategoryName
                                                </small>
                                            }
                                        </div>
                                        <div class="ms-3 text-nowrap">
                                            <a asp-action="addTask"
                                               asp-route-id="@item.TaskId"
                                               class="btn btn-sm btn-primary me-1">
                                                Edit
                                            </a>
                                            <a asp-action="Delete"
                                               asp-route-id="@item.TaskId"
                                               class="btn btn-sm btn-outline-danger me-1">
                                                Delete
                                            </a>
                                            <form asp-action="MarkComplete"
                                                  asp-route-id="@item.TaskId"
                                                  method="post"
                                                  class="d-inline">
                                                <button type="submit" class="btn btn-sm btn-success">
                                                    Mark Complete
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

